= downdoc: Down-convert AsciiDoc to Markdown
ifdef::env-github[]
:toc: preamble
:toc-title: Contents
:toclevels: 1
endif::[]

> Hastily converts AsciiDoc to Markdown.

== What is downdoc?

npm package repositories such as https://npmjs.com and https://yarnpkg.com assume the README for a package is in Markdown.
But you're a sensible developer who wants to maintain your README in AsciiDoc.
Enter downdoc.

The downdoc package provides a function and CLI to down-convert AsciiDoc to Markdown.
The intent of this tool is to prepare an AsciiDoc README for npm packaging.
It's designed to be just good enough to get the job done.

Typically, you convert the README from Markdown to AsciiDoc during the _prepublishOnly_ life cycle event.
Then you restore the original README during the _postpublish_ life cycle event.
That way, then npm package ends up with a Markdown README, but the README in your repository remains in AsciiDoc.

== How does it work?

downdoc employs a rather crude approach to map the AsciiDoc syntax to Markdown that does not use an AsciiDoc processor.
Therefore, it does not support the full AsciiDoc syntax.
It's intended to be used with simple README files.

Here's a rough list of the syntax it current handles:

* document title
* author info line in document header
* document attribute entries in document header (single-line only)
* document attribute references
* part/chapter/section titles
* block titles
* formatted text (bold, italic, monospace)
* ordered, unordered, and callout lists (1-9)
* nested ordered and unordered lists (marker must start at left margin)
* list continuation (top-level list only)
* link and URL macros
* internal xrefs (honors value of `idprefix` and `idseparator` document attributes)
* auto-generated text for internal xrefs
* block and inline image macros
* listing and source blocks with optional language
* diagram blocks (listing block with diagram dialect)
* callout numbers (1-9) in verbatim blocks
* attribute references in verbatim blocks (when attributes sub is enabled)
* literal paragraphs
* admonition paragraphs
* Markdown-style blockquotes
* ifdef and ifndef preprocessor conditionals
* comment lines and blocks
* tables (dropped)

== Prerequisites

In order to use this extension, you must be using at least Node.js 16.

== Install

Use the following command to install the downdoc package into your project:

[,console]
----
$ npm i downdoc
----

Alternately, you can defer installation and invoke the CLI via npx.

== Usage

=== CLI

[,console]
----
$ npx downdoc README.adoc
----

The `downdoc` command automatically generates a Markdown file.
The Markdown file has the same name as the AsciiDoc file with the file extension changed to `.md`.

You can instruct the command to write to a different file using the `-o` (or `--output`) option.

[,console]
----
$ npx downdoc -o out.md README.adoc
----

=== API

[,js]
----
const downdoc = require('downdoc')
const { promises: fsp } = require('node:fs')

;(async () => {
  await fsp
    .readFile('README.adoc', 'utf8')
    .then((asciidoc) => fsp.writeFile('README.md', downdoc(asciidoc) + '\n', 'utf8'))
})()
----

== Copyright and License

Copyright (C) 2022-present Dan Allen (OpenDevise Inc.) and the individual contributors to this project.

Use of this software is granted under the terms of the MIT License.
